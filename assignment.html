<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Assignment Cover Page Maker (A4 Only + Editable + PDF)</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    /* A4 exact size + responsive scale */
    .a4-wrap{display:flex;justify-content:center;overflow:auto;padding:18px;}
    .a4-page{
      width:210mm;height:297mm;background:#fff;color:#111;
      padding:14mm;border-radius:12px;border:1px solid rgba(0,0,0,.15);
      box-shadow:0 20px 70px rgba(0,0,0,.35);
      transform-origin: top center;
    }
    @media (max-width: 1100px){ .a4-page{ transform:scale(.92);} }
    @media (max-width: 980px){  .a4-page{ transform:scale(.85);} }
    @media (max-width: 820px){  .a4-page{ transform:scale(.78);} }
    @media (max-width: 680px){  .a4-page{ transform:scale(.70);} }

    @media print{
      body{background:#fff !important;}
      .no-print{display:none !important;}
      .a4-wrap{padding:0;overflow:visible;}
      .a4-page{
        transform:none !important;
        box-shadow:none !important;
        border:none !important;
        border-radius:0 !important;
        width:210mm;height:297mm;padding:14mm;
      }
    }

    /* Inline edit highlight */
    [contenteditable="true"]{outline:none;border-radius:6px;padding:1px 2px;}
    [contenteditable="true"]:focus{
      box-shadow:0 0 0 2px rgba(77,163,255,.35);
      background:rgba(77,163,255,.10);
    }
    [contenteditable="true"]{white-space:pre-wrap;}

    /* Superscript style (preview) */
    sup{
      font-size: 70%;
      vertical-align: super;
      line-height: 0;
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-slate-950 to-slate-900 text-slate-100">
  <div class="mx-auto max-w-5xl p-5">

    <!-- Topbar -->
    <div class="no-print flex items-center justify-between gap-3 rounded-2xl border border-white/10 bg-slate-900/60 backdrop-blur px-4 py-3">
      <div class="flex items-center gap-3">
        <div class="grid h-10 w-10 place-items-center rounded-xl bg-gradient-to-tr from-sky-400 to-blue-600 font-black text-slate-950">üßæ</div>
        <div>
          <div class="text-base font-black leading-tight">Assignment Cover Page</div>
          <div class="text-xs text-slate-300">A4 only ‚Ä¢ Click to edit ‚Ä¢ Upload logo ‚Ä¢ Download PDF</div>
        </div>
      </div>

      <div class="flex flex-wrap items-center gap-2">
        <input id="logoFile" type="file" accept="image/*"
          class="block w-full max-w-[240px] rounded-xl border border-white/10 bg-black/20 px-3 py-2 text-sm text-slate-100 file:mr-3 file:rounded-lg file:border-0 file:bg-sky-500/90 file:px-3 file:py-1.5 file:text-sm file:font-bold file:text-slate-950 hover:file:bg-sky-400"
        />
        <button id="resetLogoBtn" type="button"
          class="rounded-xl border border-white/10 px-3 py-2 text-sm font-black hover:bg-white/5">
          Reset Logo
        </button>
        <button id="downloadBtn" type="button"
          class="rounded-xl bg-emerald-400 px-3 py-2 text-sm font-black text-slate-950 hover:bg-emerald-300">
          Download PDF
        </button>
        <a href="index.html" class="rounded-xl border border-white/10 px-3 py-2 text-sm hover:bg-white/5">‚Üê Home</a>
      </div>
    </div>

    <!-- A4 Preview ONLY -->
    <div class="mt-4 rounded-2xl border border-white/10 bg-slate-900/60 backdrop-blur p-4">
      <div class="a4-wrap">
        <div class="a4-page" id="page">

          <!-- Logo -->
          <div class="flex justify-center">
            <img id="logoPreview"
                 src="Image/Logo_of_Premier_University_(PU).png"
                 alt="Premier University Logo"
                 class="h-[36mm] w-[54mm] object-contain" />
          </div>

          <!-- Header -->
          <div class="mt-2 text-center">
            <div id="p_uniTitle" contenteditable="true"
                 class="text-[18pt] font-black tracking-wide">PREMIER UNIVERSITY CHATTOGRAM</div>

            <div class="mt-1 inline-block border border-black px-2 py-[2px] text-[9pt]">
              <span id="p_deptPrefix" contenteditable="true" class="font-normal">DEPARTMENT OF</span>
              <span class="mx-[2px]"></span>
              <span id="p_deptBold" contenteditable="true" class="font-black">COMPUTER SCIENCE AND ENGINEERING</span>
            </div>
          </div>

          <!-- MAIN HEADING -->
          <div id="p_bigHeading" contenteditable="true"
               class="mt-6 text-center text-[18pt] font-black underline">ASSIGNMENT</div>

          <!-- Main table -->
          <table class="mt-3 w-full border-collapse text-[10.5pt]">
            <tbody>
              <tr>
                <td class="w-[33%] border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">COURSE NAME</td>
                <td id="p_courseName" contenteditable="true" class="border border-black px-2 py-2">Computer and Cyber Security</td>
              </tr>
              <tr>
                <td class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">COURSE CODE</td>
                <td id="p_courseCode" contenteditable="true" class="border border-black px-2 py-2">CSE 3637</td>
              </tr>

              <!-- ‚úÖ EDITABLE LABEL: ASSIGNMENT NO -->
              <tr>
                <td id="p_assignNoLabel" contenteditable="true"
                    class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">ASSIGNMENT NO</td>
                <td id="p_assignNo" contenteditable="true" class="border border-black px-2 py-2">01</td>
              </tr>

              <!-- ‚úÖ EDITABLE LABEL: ASSIGNMENT NAME -->
              <tr>
                <td id="p_assignNameLabel" contenteditable="true"
                    class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">ASSIGNMENT NAME</td>
                <td id="p_assignName" contenteditable="true" class="border border-black px-2 py-2">Secure Authentication in Digital Banking Amid Fraudulent Transactions</td>
              </tr>

              <!-- ‚úÖ EDITABLE LABEL: DATE OF ASSIGNMENT -->
              <tr>
                <td id="p_dateAssignLabel" contenteditable="true"
                    class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">DATE OF ASSIGNMENT</td>
                <td id="p_dateAssign" contenteditable="true" class="border border-black px-2 py-2">09.09.25</td>
              </tr>

              <tr>
                <td class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">DATE OF SUBMISSION</td>
                <td id="p_dateSub" contenteditable="true" class="border border-black px-2 py-2">09.10.25</td>
              </tr>

              <tr>
                <td colspan="2" class="border border-black bg-neutral-100 px-2 py-2 text-[10pt] font-black uppercase">
                  SUBMITTED TO
                </td>
              </tr>
              <tr>
                <td colspan="2" class="border border-black px-2 py-3 text-center">
                  <div id="p_subToName" contenteditable="true" class="text-[12pt] font-black">Md. Shafiul Alam Forhad</div>
                  <div id="p_subToMeta" contenteditable="true" class="text-[10pt]">Assistant Professor, Department of CSE, CUET</div>
                </td>
              </tr>

              <tr>
                <td colspan="2" class="border border-black bg-neutral-100 px-2 py-2 text-[10pt] font-black uppercase">
                  SUBMITTED BY
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Small table -->
          <table class="w-full border-collapse text-[10.5pt]" style="margin-top:-1px;">
            <tbody>
              <tr>
                <td class="w-[20%] border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">NAME</td>
                <td id="p_subByName" contenteditable="true" class="border border-black px-2 py-2">Sariful Islam</td>
              </tr>
              <tr>
                <td class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">ID</td>
                <td id="p_subById" contenteditable="true" class="border border-black px-2 py-2">0222220005101023</td>
              </tr>

              <tr>
                <td class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">SEMESTER</td>
                <td id="p_semester" contenteditable="true" class="border border-black px-2 py-2">6<sup>th</sup></td>
              </tr>

              <tr>
                <td class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">BATCH</td>
                <td id="p_batch" contenteditable="true" class="border border-black px-2 py-2">42<sup>nd</sup></td>
              </tr>

              <tr>
                <td class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">SESSION</td>
                <td id="p_session" contenteditable="true" class="border border-black px-2 py-2">Spring 2025</td>
              </tr>
              <tr>
                <td class="border border-black px-2 py-2 text-[9.5pt] font-extrabold uppercase">SECTION</td>
                <td id="p_section" contenteditable="true" class="border border-black px-2 py-2">A</td>
              </tr>
            </tbody>
          </table>

        </div>
      </div>

      <div class="no-print mt-3 text-xs text-slate-300">
        ‚úÖ ‡¶è‡¶ñ‡¶® Left label ‡¶ó‡ßÅ‡¶≤‡ßã edit ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá: ‚ÄúASSIGNMENT NO/NAME/DATE‚Ä¶‚Äù ‚Üí ‚ÄúREPORT NO/NAME/DATE‚Ä¶‚Äù<br/>
        ‚úÖ PDF-‡¶è‡¶ì ‡¶†‡¶ø‡¶ï ‡¶è‡¶ï‡¶á label ‡¶Ø‡¶æ‡¶¨‡ßá‡•§
      </div>
    </div>
  </div>

<script>
  const DEFAULT_LOGO_PATH = "Image/Logo_of_Premier_University_(PU).png";
  const logoPreview = document.getElementById("logoPreview");
  const logoFile = document.getElementById("logoFile");
  const resetLogoBtn = document.getElementById("resetLogoBtn");
  const downloadBtn = document.getElementById("downloadBtn");

  const state = { logoDataUrl: "" };

  function getText(id){
    const el = document.getElementById(id);
    return (el?.textContent || "").trim();
  }
  function getHTML(id){
    const el = document.getElementById(id);
    return (el?.innerHTML || "").trim();
  }

  // Smart ordinal
  function toOrdinalHTML(plain){
    const t = (plain || "").trim();
    const m = t.match(/^(\d+)\s*(st|nd|rd|th)$/i);
    if (!m) return null;
    return `${m[1]}<sup>${m[2].toLowerCase()}</sup>`;
  }

  function placeCaretAtEnd(el){
    el.focus();
    const range = document.createRange();
    range.selectNodeContents(el);
    range.collapse(false);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
  }

  // ‚úÖ FIX: keepFocus param
  function normalizeOrdinalField(el, keepFocus = false){
    const plain = (el.textContent || "").trim();
    if (!plain) { el.innerHTML = ""; return; }

    const html = toOrdinalHTML(plain);
    if (!html) return;

    el.innerHTML = html;

    // ‚úÖ Only keep caret while actively editing this field
    if (keepFocus && document.activeElement === el){
      placeCaretAtEnd(el);
    }
  }

  // Logo upload
  logoFile.addEventListener("change", (e)=>{
    const file = e.target.files?.[0];
    if (!file){
      state.logoDataUrl = "";
      logoPreview.src = DEFAULT_LOGO_PATH;
      return;
    }
    const reader = new FileReader();
    reader.onload = ()=>{
      state.logoDataUrl = reader.result;
      logoPreview.src = state.logoDataUrl;
    };
    reader.readAsDataURL(file);
  });

  resetLogoBtn.addEventListener("click", ()=>{
    state.logoDataUrl = "";
    logoFile.value = "";
    logoPreview.src = DEFAULT_LOGO_PATH;
  });

  // PDF helpers
  function drawCell(doc, x, y, w, h, text, opt={}){
    const pad = opt.pad ?? 2.2;
    const bold = !!opt.bold;
    const align = opt.align || "left";
    const fontSize = opt.fontSize || 11;

    doc.rect(x, y, w, h);
    doc.setFont("helvetica", bold ? "bold" : "normal");
    doc.setFontSize(fontSize);

    const maxW = w - pad*2;
    const lines = doc.splitTextToSize(text || "", maxW);

    const lineH = fontSize * 0.35 + 3;
    const textH = lines.length * lineH;
    const ty = y + (h - textH)/2 + fontSize*0.35 + 1;

    let tx = x + pad;
    if (align === "center") tx = x + w/2;
    if (align === "right") tx = x + w - pad;

    doc.text(lines, tx, ty, {align});
  }

  function parseOrdinalFromHTML(html){
    const div = document.createElement("div");
    div.innerHTML = html || "";
    const text = (div.textContent || "").trim();
    const m = text.match(/^(\d+)\s*(st|nd|rd|th)$/i);
    if (!m) return null;
    return { base: m[1], suf: m[2].toLowerCase() };
  }

  function drawOrdinalPDF(doc, htmlOrText, x, y, opt={}){
    const align = opt.align || "left";
    const fontSize = opt.fontSize || 11;
    const bold = !!opt.bold;

    const parsed = parseOrdinalFromHTML(htmlOrText) || (()=>{
      const t = (htmlOrText || "").trim();
      const m = t.match(/^(\d+)\s*(st|nd|rd|th)$/i);
      return m ? { base:m[1], suf:m[2].toLowerCase() } : null;
    })();

    doc.setFont("helvetica", bold ? "bold" : "normal");

    if (!parsed){
      doc.setFontSize(fontSize);
      const t = (htmlOrText || "‚Äî").replace(/<[^>]*>/g, "").trim() || "‚Äî";
      doc.text(t, x, y, {align});
      return;
    }

    const base = parsed.base;
    const suf = parsed.suf;
    const sufSize = Math.max(7, Math.round(fontSize * 0.62));

    doc.setFontSize(fontSize);
    const baseW = doc.getTextWidth(base);

    doc.setFontSize(sufSize);
    const sufW = doc.getTextWidth(suf);

    const totalW = baseW + sufW;

    let startX = x;
    if (align === "center") startX = x - totalW/2;
    if (align === "right") startX = x - totalW;

    doc.setFontSize(fontSize);
    doc.text(base, startX, y);

    const liftMm = 1.05;
    doc.setFontSize(sufSize);
    doc.text(suf, startX + baseW, y - liftMm);
  }

  async function urlToDataURL(url){
    const res = await fetch(url);
    if (!res.ok) throw new Error("Logo not found: " + url);
    const blob = await res.blob();
    return await new Promise((resolve)=>{
      const reader = new FileReader();
      reader.onload = ()=>resolve(reader.result);
      reader.readAsDataURL(blob);
    });
  }

  function drawDeptMixed(doc, centerX, y, prefix, boldPart, fontSize=9){
    doc.setFontSize(fontSize);

    const gap = "\u00A0";

    doc.setFont("helvetica","normal");
    const wPrefix = doc.getTextWidth(prefix);
    const wGap = doc.getTextWidth(gap);

    doc.setFont("helvetica","bold");
    const wBold = doc.getTextWidth(boldPart);

    const total = wPrefix + wGap + wBold;
    let startX = centerX - total/2;

    doc.setFont("helvetica","normal");
    doc.text(prefix, startX, y);
    startX += wPrefix;

    doc.text(gap, startX, y);
    startX += wGap;

    doc.setFont("helvetica","bold");
    doc.text(boldPart, startX, y);
  }

  async function downloadPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("p","mm","a4");

    const margin = 14;
    let y = margin;

    let logoData = state.logoDataUrl;
    if (!logoData){
      try{ logoData = await urlToDataURL(DEFAULT_LOGO_PATH); }
      catch(e){ logoData = ""; }
    }

    if (logoData){
      try{
        const imgW = 54, imgH = 36;
        const x = (210 - imgW)/2;
        doc.addImage(logoData, "PNG", x, y, imgW, imgH);
        y += imgH + 4;
      }catch(e){ y += 4; }
    } else { y += 4; }

    doc.setFont("helvetica","bold");
    doc.setFontSize(16);
    doc.text(getText("p_uniTitle") || "‚Äî", 105, y + 6, {align:"center"});

    const deptBoxW = 120, deptBoxH = 6;
    const deptX = (210 - deptBoxW)/2;
    const deptY = y + 10;
    doc.setLineWidth(0.2);
    doc.rect(deptX, deptY, deptBoxW, deptBoxH);

    drawDeptMixed(
      doc,
      105,
      deptY + 4.3,
      getText("p_deptPrefix") || "‚Äî",
      getText("p_deptBold") || "‚Äî",
      9
    );

    const bigHeading = getText("p_bigHeading") || "ASSIGNMENT";
    doc.setFont("helvetica","bold");
    doc.setFontSize(18);
    const titleY = deptY + 18;
    doc.text(bigHeading, 105, titleY, {align:"center"});
    doc.setLineWidth(0.4);
    const tw = doc.getTextWidth(bigHeading);
    doc.line(105 - tw/2, titleY + 1.2, 105 + tw/2, titleY + 1.2);

    let tableY = titleY + 8;
    const tableX = margin;
    const tableW = 210 - margin*2;
    const leftW = tableW * 0.33;
    const rightW = tableW - leftW;
    const rowH = 12;

    doc.setLineWidth(0.2);

    // ‚úÖ labels pulled from editable cells
    const assignNoLabel   = getText("p_assignNoLabel")   || "ASSIGNMENT NO";
    const assignNameLabel = getText("p_assignNameLabel") || "ASSIGNMENT NAME";
    const dateAssignLabel = getText("p_dateAssignLabel") || "DATE OF ASSIGNMENT";

    const rows = [
      ["COURSE NAME", getText("p_courseName")],
      ["COURSE CODE", getText("p_courseCode")],
      [assignNoLabel, getText("p_assignNo")],
      [assignNameLabel, getText("p_assignName")],
      [dateAssignLabel, getText("p_dateAssign")],
      ["DATE OF SUBMISSION", getText("p_dateSub")]
    ];

    rows.forEach(([lab, v])=>{
      drawCell(doc, tableX, tableY, leftW, rowH, lab, {bold:true, fontSize:10});
      drawCell(doc, tableX + leftW, tableY, rightW, rowH, v || "‚Äî", {fontSize:11});
      tableY += rowH;
    });

    drawCell(doc, tableX, tableY, tableW, 10, "SUBMITTED TO", {bold:true, fontSize:10});
    tableY += 10;

    const subToH = 18;
    drawCell(doc, tableX, tableY, tableW, subToH, "", {});
    doc.setFont("helvetica","bold"); doc.setFontSize(12);
    doc.text(getText("p_subToName") || "‚Äî", 105, tableY + 7, {align:"center"});
    doc.setFont("helvetica","normal"); doc.setFontSize(11);
    doc.text(getText("p_subToMeta") || "‚Äî", 105, tableY + 13.2, {align:"center"});
    tableY += subToH;

    drawCell(doc, tableX, tableY, tableW, 10, "SUBMITTED BY", {bold:true, fontSize:10});
    tableY += 10;

    const smallRows = [
      ["NAME", getText("p_subByName")],
      ["ID", getText("p_subById")],
      ["SEMESTER", getHTML("p_semester")],
      ["BATCH", getHTML("p_batch")],
      ["SESSION", getText("p_session")],
      ["SECTION", getText("p_section")]
    ];

    const smallLeft = leftW * 0.6;

    smallRows.forEach(([lab, v])=>{
      drawCell(doc, tableX, tableY, smallLeft, 11, lab, {bold:true, fontSize:10});
      doc.rect(tableX + smallLeft, tableY, tableW - smallLeft, 11);

      const rx = tableX + smallLeft + 2.2;
      const baselineY = tableY + 7.35;

      const plain = (v || "").replace(/<[^>]*>/g, "").trim();
      const isOrdinal = /^\d+\s*(st|nd|rd|th)$/i.test(plain);

      if (isOrdinal){
        drawOrdinalPDF(doc, v, rx, baselineY, {align:"left", fontSize:11});
      } else {
        doc.setFont("helvetica","normal");
        doc.setFontSize(11);
        const txt = plain || "‚Äî";
        const lines = doc.splitTextToSize(txt, (tableW - smallLeft) - 4.4);
        doc.text(lines, rx, baselineY);
      }

      tableY += 11;
    });

    doc.save("assignment-cover-page.pdf");
  }

  downloadBtn.addEventListener("click", downloadPDF);

  // contenteditable UX
  document.querySelectorAll('[contenteditable="true"]').forEach(el=>{
    el.addEventListener("keydown", (e)=>{
      if (e.key === "Enter"){
        document.execCommand("insertLineBreak");
        e.preventDefault();
      }
    });

    el.addEventListener("paste", (e)=>{
      const id = el.id;
      if (id === "p_semester" || id === "p_batch") return;
      e.preventDefault();
      const text = (e.clipboardData || window.clipboardData).getData("text");
      document.execCommand("insertText", false, text);
    });
  });

  // ‚úÖ FIXED: ordinal auto-superscript without trapping focus
  ["p_semester","p_batch"].forEach(id=>{
    const field = document.getElementById(id);
    if (!field) return;

    field.addEventListener("input", ()=> normalizeOrdinalField(field, true));
    field.addEventListener("blur",  ()=> normalizeOrdinalField(field, false));
  });
</script>
</body>
</html>
